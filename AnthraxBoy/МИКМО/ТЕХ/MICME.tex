%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Основной файл для авторов журнала MICME
%%%%% факультет математики и информатики
%%%%% Таврическая академия Крымского федерального университета им. В.И. Вернадского
%%%%% e-mail: micme2017@yandex.ru
%%%%% site: http://micme.cfuv.ru/ 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%ПРАВИЛА ОФОРМЛЕНИЯ МАТЕРИАЛОВ:
%
%Материалы должны быть оформлены с использованием стилевого файла micmo.cls по образцу примера MICME.tex в редакторе LaTeX на русском или английском языке.
%
%Название файла формируйте следующим образом Surname.tex
%Surname – фамилия, написанная по-английски без пробелов.



\documentclass{micmo}
\usepackage[cp1251]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[english,ukrainian,russian]{babel}
\sloppy
%\newcommand{\ds}{\displaystyle}

\topmatter{А.\;В.\;Консманов} %укажите свои инициалы и фамилию в предложенном формате

\udc{519.673} %укажите УДК вашей работы

\title{Моделирование распространения инфекционных заболеваний на графах с помощью Python и AnyLogic} %укажите название вашей работы

%\thanks{Работа выполнена при финансовой поддержке~\ldots}

\author{А.\;В.\;Консманов}%\author{инициалы и фамилия}
{Крымский федеральный университет им.\;В.\;И.\;Вернадского, \textit{e-mail: alexkoshernosiegov@gmail.com}} %{контактные данные}
%TODO: поменять на 1.5.2019??       
\date{30.04.2019} %дата подачи работы
%TODO: узнать 
\enabstracts{65C99}%\enabstracts{обозначения MSC2010}
{A.\;V.\;Konsmanov}%{инициалы и фамилия на английском языке}
{V.\;I.\;Vernadsky Crimean Federal University} %{контактные данные на английском языке}
{Modeling the spread of infectious diseases on graphs using Python and AnyLogic}%{название работы на английском языке}
{The article is devoted to building of two models describing the spread of Ebola fever. To build the models, two different approaches that implement similar ideas were used. Models were trained on first population and tested on another one. The analysis of the accuracy of the approximation was carried out according to the graphs and shows that the models are chosen correctly, work with different accuracy and can be used to predict the nature of Ebola outbreaks.}%{аннотация на английском языке}
{Mathematical modeling, Ebola virus disease,  Infectious Disease, AnyLogic.}%{ключевые слова на английском языке} 

\begin{document}
	\begin{article}
		
		\abstracts{Рассматривается задача построения двух моделей, описывающих распространения лихорадки Эбола. Для построения моделей использовались два различных подхода, реализующие схожие идеи. Модели обучались на одной популяции и тестировались на другой. Анализ точности аппроксимации проводился по графикам и показывает, что модели подобрано верно, работают с разной точностью и могут быть использованы для предсказания характера вспышек лихорадки Эбола.}%{текст аннотации}
		{Математическое моделирование, лихордка Эбола, инфекционные заболевания, AnyLogic.} %{ключевые слова}
		
		
		\section*{Введение}
		
		%В классической литературе~\cite[c. 45]{Surname:year:1}
		Достигнутые на сегодня успехи в области борьбы с инфекционными заболеваниями не дают эффективного метода полностью предотвратить эпидемию, однако, используя прогностические математические модели, описывающие качественные и количественные характеристики очагов заражения, можно значительно снизить количество заболевших в первые дни вспышки и, тем самым, избежать превращения вспышки в эпидемию. ~\cite[с. 202]{Beily:1970:1}
		
		
		Основные задачи, возникающие при исследовании и прогнозировании распространения инфекционных заболеваний: исследование скорости и масштаба распространения заболевания, последствий инфекционной вспышки, пространственные масштабы заражения, затраты средств и ресурсов, необходимых для изоляции и лечения больных. ~\cite[c. 203]{Beily:1970:1}
		Среди моделей была выбрана мультиагентная модель на графах. Данный класс моделей позволяет учитывать характеристики пространства имитируемой  области и отдельных представителей популяции. 	
		%\section{Раздел}
		\section{Стохастическая модель}
		За основу взят мультиагентный подход, где агенты распределены по локациям, которые в случайном порядке посещаются зараженными агентами. Между здоровыми и больными агентами возможно событие инфицирования, вероятность которого описывается эмпирической  формулой 
		\begin{equation}\label{stohastic_eq:1}
		P_i = 1 - \operatorname{e}^{\tau N_r \ln(1-rS_i\rho)}
		\end{equation}
		, где $P_i$ -- вероятность инфицирования  i-го агента, $\tau$  -- коэффициент расстояния, важный при передаче заболевания на большие дистанции, например, при межконтинентальных перевозках, (в данной модели предполагается нейтральным по умножению, т.е = 1), $N_r$ -- кол-во зараженных данным заболеванием (в данной локации), $S_i$ -- восприимчивость индивида i (индивидуальный параметр, требующий итеративной калибровки, в данной модели индивиды популяции имеют распределение, близкое к гамма-распределению), $\rho$ -- допустимость, т.е вероятность заражения одного индивида другим за фиксированное время (обычно, 1 минута, в данной модели -- одни сутки, т.е время пребывания агента в одной локации). 
		
		Переходы по “больным” состояниям, описанным ниже в SEIFDR-модели,  представляет собой пуассоновский процесс. 
		
		
		
		Реализация: Python3 + SciPy + GraphX(библиотека для графов) + MatPlotLib(визуализация) + Yandex Static API (визуализация на карте). 
		
		
		Преимущества: простота понимания модели, наличие большого количества готовых решений во всей предметной области, алгоритм допускает параллельную реализацию, скорость работы модели в целом выше, чем у следующей, т.к отсутствует задача численного решения СДУ, исходный код модели, за исключением ресурсных файлов и выходных файлов визуализации, <<легче>>, чем у следующей модели.
		
		
		Недостатки: отдельные фрагменты требуют долгой реализации, готовая модель требует длительной итеративной калибровки для получения результатов, приближенных к реальным, невозможно заранее установить, будет ли модель выполнять прогностическую функцию или является лишь <<подогнанной>> к уже произошедшим вспышкам, что требует тестирования на нескольких населенных пунктах; стохастическая природа модели требует мощных  и надежных генераторов случайных чисел.
		
		Данная модель уступает в точности следующей, что заметно на графика.
		
		\section{Дифференциальная мультиагентная модель на графах}
		
		За основу взята модель Кермака-МакКендрика (SIR-модель), модифицированная до SЕIFDR-модели. В основе данного подхода лежит формула, разработанная Кермаком и МакКендриком в 193 г. для SIR-модели. Как и в прошлой модели, агенты расположены в локациях, однако в этой модели, агенты могут перемещаться с некоторой динамикой и активно контактировать между собой. Изначальная SIR-модель предполагает, что агенты могут быть в трех состояниях: Suspected -- предполагаемое инфицирование или инкубационный период, Infected -- агент заразен, Recovered -- агент выздоровел и приобрел иммунитет. 
		
		Данная модель допускает модификацию до SEIFDR, где Exposed -- люди, находящиеся в инкубационном периоде, Funeral -- погибшие, еще незахороненные, все еще источник инфекции, Died -- погребенные, и описывается СДУ:
		\begin{equation}\label{SEIFDR_eq:1}
		\begin{cases}
		\dfrac{dS}{dt} = -\beta_i S I + \beta_F S F \\
		\dfrac{dE}{dt} = \beta_I S I + \beta_F S F - \alpha E \\
		\dfrac{dI}{dt} = \alpha E - I \gamma_D ( (1 - \delta_D) + \gamma_D \delta_D) \\
		\dfrac{dF}{dt} = \gamma_D \delta_D I - \gamma_F F \\
		\dfrac{dR}{dt} = \gamma_I(1-\delta_D) I + \gamma_F F
		\end{cases}
		\end{equation}
		, где $\beta_I$ и $\beta_F$ -- интенсивность контактов между людьми и на похоронах, $\alpha$ --  интенсивность инкубационного периода, $\gamma_I$ интенсивность выздоровления, $\gamma_D$  интенсивность умирания агентов, $\gamma_F$ --   интенсивность похорон, $\delta_D$ -- вероятность смертности.  
		
		Реализация: в качестве имитационной среды выбран AnyLogic, т.к данное ПО совмещает простоту и вариативность при построении модели, предоставляет широкие и мощные инструменты для численного решения СДУ.
		
		Преимущества: высокая точность дифф.моделей, возможность шире представить воздействующие факторы, более гибкая и настраиваемая модель, наличие готового имитационного ПО, наличие в имитационном ПО встроенных численных методов решения ДУ и СДУ, имеющих гарантированную сходимость, аппроксимацию, устойчивость.
		
		Недостатки: высокая вычислительная трудность в терминах времени и памяти, необходимость многократного повторения эксперимента для подбора точного значения параметров, имеются проблемы, как и в стохастической модели, есть зависимость от генераторов случайных чисел, что порождает аналогичные проблемы.
		
		Данная модель намного лучше аппроксимирует динамику заболеваемости и смертности, что заметно на графиках, представленных ниже.
		
		\section{<<Обучение>> и калибровка моделей}
		
		После введения параметров и их примерной настройки по предварительным экспериментам, проводился процесс калибровки. Для этого на каждое изменение параметра приходится 20 итераций. ~\cite[c. 190]{Kondratiev:2010:1} ~\cite[c. 873]{Kondratiev:2013:1}  
		Для выбора оптимального множества параметров используется минимизация целевой функции, которая рассчитывается следующим образом: пусть каждая точка графика, описывающего реальные показатели заболеваемости и / или смертности, обозначается парой координат $X^{\text{целевое}}_i, Y^{\text{целевое}}_i$, а каждая точка графика, описывающего работу модели, -- $X^{\text{моделируемое}}_i, Y^{\text{моделируемое}}_i$, $i = \overline{1,n}$. Тогда целевая функция имеет вид \begin{equation} \label{target_function:1}
		Dev(x) = \dfrac{\sum_{i=0}^{n} \sqrt{(X^{\text{целевое}}_i - X^{\text{моделируемое}}_i) ^ 2 + (Y^{\text{целевое}}_i - Y^{\text{моделируемое}}_i) ^ 2   }}{n}
		\end{equation}, что с учетом равенства $X^{\text{целевое}}_i$  и $X^{\text{моделируемое}}_i$ дает 
		\begin{equation} \label{target_function:2}
		Dev(x) = \dfrac{\sum_{i=0}^{n}  \sqrt{(Y^{\text{целевое}}_i - Y^{\text{моделируемое}}_i) ^ 2   }}{n}
		\end{equation}
		и после упрощения 
		\begin{equation} \label{target_function:3}
		Dev(x) = \dfrac{\sum_{i=0}^{n}  (Y^{\text{целевое}}_i - Y^{\text{моделируемое}}_i)}{n}  
		\end{equation}
		Для анализа правильности калибровки параметров, модели настраивалась на городе Кенема, затем сравнивались с результатами по Кайлхуну. Данные взяты из открытых источников WHO и Министерства Здравоохранения Сьерра-Леоне \cite{githubwho:2014:1} \cite{whodata:2016:1}. Анализ проводился по графикам, представленным ниже,  и аналитически по значению функции ~\eqref{target_function:3}. 
		
		
		%TODO: Сюда графики 
		
		\begin{figure*}[h!]
			\centering{\includegraphics[scale=0.45]{Images/Infected_Dynamic.png}}
			\caption{Динамика заболеваемости в г. Кайлхун. Синий цвет соответствует реально наблюдавшимся значениям, красный описывает результат дифференциальной модели, зеленый -- стохастической.}
		\end{figure*}
		
		
		\begin{figure*}[h!]
			\centering{\includegraphics[scale=0.45]{Images/Dead_Dynamic.png}}
			\caption{FAG}
		\end{figure*}	
		\newpage
		По графикам хорошо заметно, что дифференциальная модель аппроксимирует реальное значение намного точнее, чем модель на графах. Тем не менее, обе модели могут быть использованы при реальном прогнозировании, при этом специалист может выбрать сам, исходя из вычислительных мощностей, какая из моделей доступнее для него.
		
		
		
		\section*{Заключение}
		В работе были проанализированы и сопоставлены два подхода к проблеме моделирования и прогнозирования характера распространения лихорадки Эбола. Обе модели были реализованы в виде полноценных приложений. Полученные приложения могут быть использованы специалистом-эпидемиологом при подозрении на начало вспышки заболевания.
		
		
		%\newpage
		
		%источник задаётся в формате, соответствующем ГОСТ Р 7.0.9 – 2009 («Система стандартов по информации, библиотечному и издательскому делу. Библиографическое обеспечение издательских и книготорговых процессов. Общие требования»)
		%чтобы использовать цитирование в тексте, сделайте в списке источников указание вида:
		%\refitem{название ссылки для цитирования}
		%{имя автора}
		
		\begin{references}
			%\refitem{Surname:year:1}
			%{Фамилия\;И.\;О.} Название публикации~// Журнал.~-- Год.~-- том X, вып. X~-- С.~1--2.
			\refitem{Beily:1970:1}
			{Бейли\;Н.}  Математика в биологии и медицине~// М.: Мир.~-- 1970. ~-- 	С.202-205.
			\refitem{Kondratiev:2010:1}
			{Кондратьев\;М.\;А.} Применение агентного подхода к имитационному моделированию процесса распространения заболевания~// Научно-технические ведомости СПбГПУ. Серия «Наука и образование». ~-— 2010. ~-- том 2, вып. 2. ~-- С.~189–195.
			\refitem{Kondratiev:2013:1}
			{Кондратьев\;М.\;А.} Методы прогнозирования и модели распространения заболеваний~// Компьютерные исследования и моделирование.~-- 2013.~-- том 5, вып. 5~-- С.~863--882
			\refitem{githubwho:2014:1}
			{GitHub} [Электронный ресурс].- Режим доступа: https://github.com/cmrivers/ebola .- GitHub.- Проверено 27.04.2019
			\refitem{whodata:2016:1}
			{WHO.int} [Электронный ресурс]. - Режим доступа: http://apps.who.int/gho/data/node.ebola-sitrep.quick-downloads?lang=en .- WHO.int.- Проверено 27.04.2019 
		\end{references}
		%\listofruabstracts\listofenabstracts
		
	\end{article}
\end{document}